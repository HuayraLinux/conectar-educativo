var apiWrapper = (function () {

    var https = require('https');
    var api = {};
    api.uri = {};

    api.key = "263e0b0bccb1ae7310f913b404a351f3ab010f7f";
    api.hostname = 'https://api.educ.ar';

    api.uri.recursos = {
        buscarJuegos  : api.hostname + "/0.9/recursos/juegos?key=" + api.key + "&q=",
        buscarVideos  : api.hostname + "/0.9/recursos/videos?key=" + api.key + "&q=",
        buscarEbooks  : api.hostname + "/0.9/recursos/ebooks?key=" + api.key + "&q=",
        buscarSecuencias  : api.hostname + "/0.9/recursos/secuencias?key=" + api.key + "&q=",
        buscarInfografias : api.hostname + "/0.9/recursos/infografias?key=" + api.key + "&q=",
        detalleJuegos : api.hostname + "/0.9/recursos/juegos/[id]?key=" + api.key,
        detalleVideos : api.hostname + "/0.9/recursos/juegos/[id]?key=" + api.key,
        detalleEbooks : api.hostname + "/0.9/recursos/juegos/[id]?key=" + api.key,
        detalleSecuencias : api.hostname + "/0.9/recursos/juegos/[id]?key=" + api.key,
        detalleInfografias : api.hostname + "/0.9/recursos/juegos/[id]?key=" + api.key,
        obtenerCatalogacion : api.hostname + "/0.9/recursos/catalogacion?key=" + api.key,
        ramaCatalogacion : api.hostname + "/0.9/recursos/catalogacion/[id]?key=" + api.key,
    };
 
    this._get = function(url, onErrorCallback, onSuccessCallback){ 
        console.log(url);
        https.get(url, function(res) {
          res.on('data', onSuccessCallback);
        }).on('error', onErrorCallback);
    };

    this._buscarBuilder = function(uri){
        return function(data, onErrorCallback, onSuccessCallback){
            var url = uri + JSON.stringify(data);
            this._get(url, onErrorCallback, onSuccessCallback);
        }
    };

    this._detalleBuilder = function(uri){
        return function(id, onErrorCallback, onSuccessCallback){
            var url = uri.replace("[id]", id);
            this._get(url, onErrorCallback, onSuccessCallback);
        }
    };

    this._obtenerBuilder = function(uri){
        return function(onErrorCallback, onSuccessCallback){
            this._get(uri, onErrorCallback, onSuccessCallback);
        }
    };

    this._ramaBuilder = function(uri){
        this._detalleBuilder(uri);
    };

    for(var methodName in api.uri.recursos){
        if(methodName.match("buscar")){
            this[methodName] = this._buscarBuilder(api.uri.recursos[methodName]);
        }else if(methodName.match("detalle")){
            this[methodName] = this._detalleBuilder(api.uri.recursos[methodName]);
        }else if(methodName.match("obtener")){
            this[methodName] = this._obtenerBuilder(api.uri.recursos[methodName]);
        }else if(methodName.match("rama")){
            this[methodName] = this._detalleBuilder(api.uri.recursos[methodName]);
        }
    }

    return this;
})();
 
module.exports = apiWrapper;